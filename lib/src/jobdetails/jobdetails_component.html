<material-button (trigger)="goBack()">Zurück</material-button>

<h2>Jobdetails für {{ job?.jobInfo?.filename }}</h2>

<div>
    <material-button tooltipTarget #refPrint="tooltipTarget" raised (trigger)="openPrintDialog()" *ngIf="directPrinter">
        <material-icon icon="printer"></material-icon>
        <material-tooltip-text [for]="refPrint">
            <header>Job {{ (leftPrinter.isNotEmpty) ? 'links' : 'rechts' }} drucken</header>
        </material-tooltip-text>
    </material-button>
    <material-button tooltipTarget #refDelete="tooltipTarget" raised (trigger)="deleteJob()">
        <material-icon icon="delete"></material-icon>
        <material-tooltip-text [for]="refDelete">
            <header>Job löschen</header>
        </material-tooltip-text>
    </material-button>
    <material-button tooltipTarget #refDownload="tooltipTarget" raised (trigger)="downloadPdf()">
        <material-icon icon="cloud_download"></material-icon>
        <material-tooltip-text [for]="refDownload">
            <header>Zugehörige PDF herunterladen</header>
        </material-tooltip-text>
    </material-button>
    <material-button raised tooltipTarget #refKeep="tooltipTarget" (trigger)="onKeepJob(job?.id)">
        <material-icon [icon]="(job?.jobOptions?.keep ?? false) ? 'favorite' : 'favorite_outline'">
        </material-icon>
        <material-tooltip-text [for]="refKeep">
            <header>Job nach dem Drucken behalten</header>
        </material-tooltip-text>
    </material-button>
    <div id="link-area"></div>
</div>

<div id="jobdetails">
    <div id="card-grid">
        <div class="mdc-card mdc-card--outlined job-card">
            <b class="heading">Infos zum Originaldokument:</b><br>
            <material-list-item class="options-row">
                <div class="options-key">
                    Dateiname:
                </div>
                <div class="options-value">
                    {{ job?.jobInfo?.filename }}
                </div>
            </material-list-item>
            <material-list-item class="options-row">
                <div class="options-key">
                    Seitenzahl:
                </div>
                <div class="options-value">
                    {{ job?.jobInfo?.pagecount }}
                </div>
            </material-list-item>
            <material-list-item class="options-row">
                <div class="options-key">
                    Farbseiten:
                </div>
                <div class="options-value">
                    {{ job?.jobInfo?.colored }}
                </div>
            </material-list-item>
            <material-list-item class="options-row">
                <div class="options-key">
                    A3:
                </div>
                <div class="options-value">
                    {{ (job?.jobInfo?.a3 ?? false) ? 'Ja' : 'Nein' }}
                </div>
            </material-list-item>
        </div>

        <div class="mdc-card mdc-card--outlined estimation-card">
            <b>Erwartete Kosten für das ganze Dokument:</b>
            <b class="jobdetails-credit">{{ (estimatedDouble | number:'1.2-2')?.toString() }} €</b>
            Verbleibendes Guthaben nach Druck:
            {{ (((user?.credit ?? 0) / 100 - estimatedDouble)  | number:'1.2-2').toString() }} €
        </div>

        <div class="mdc-card mdc-card--outlined job-card">
            <b>Optionen:</b>
            <material-list>
                <div group>
                    <material-list-item class="options-row">
                        <div class="options-key">
                            Farbe:
                        </div>
                        <div class="options-value">
                            <material-toggle [checked]="color" (checkedChange)="colorChecked()"></material-toggle>
                        </div>
                    </material-list-item>
                    <material-list-item class="options-row">
                        <div class="options-key">
                            Duplex:
                        </div>
                        <div class="options-value">
                            <material-dropdown-select [selection]="duplexSelection" [options]="duplexOptions"
                                [buttonText]="duplexSelection" (selectionChange)="duplexChanged">
                            </material-dropdown-select>
                        </div>
                    </material-list-item>
                    <material-list-item class="options-row">
                        <div class="options-key">
                            A3:
                        </div>
                        <div class="options-value">
                            <material-toggle [checked]="a3" (checkedChange)="a3Checked()">
                            </material-toggle>
                        </div>
                    </material-list-item>
                </div>

                <div group>
                    <material-list-item class="options-row">
                        <div class="options-key">
                            Anzahl Kopien:
                        </div>
                        <div class="options-value">
                            <input type="number" [(ngModel)]="copies" (change)="copiesChanged()" min="1" max="999">
                        </div>
                    </material-list-item>
                    <material-list-item class="options-row">
                        <div class="options-key">
                            Kopien zusammenhalten:
                        </div>
                        <div class="options-value">
                            <material-toggle [checked]="collate" (checkedChange)="collateChecked()"></material-toggle>
                        </div>
                    </material-list-item>
                    <material-list-item class="options-row" *ngIf="(job?.jobInfo?.pagecount ?? 1 * copies) > 1">
                        <div class="options-key">
                            Seitenbereich:
                        </div>
                        <div class="options-value">
                            <material-input hint="Alle" [(ngModel)]="range" (change)="rangeChanged()"></material-input>
                        </div>
                    </material-list-item>
                    <material-list-item class="options-row" *ngIf="(job?.jobInfo?.pagecount ?? 1 * copies) > 1">
                        <div class="options-key">
                            Seiten pro Blatt:
                        </div>
                        <div class="options-value">
                            <material-dropdown-select [selection]="nupSelection" [options]="nupOptions"
                                [buttonText]="nupSelection" (selectionChange)="nupChanged">
                            </material-dropdown-select>
                        </div>
                    </material-list-item>
                    <material-list-item class="options-row" *ngIf="nup > 2">
                        <div class="options-key">
                            Reihenfolge auf dem Blatt:
                        </div>
                        <div class="options-value">
                            <material-dropdown-select [selection]="nupOrderSelection" [options]="nupOrderOptions"
                                [buttonText]="nupOrderSelection" (selectionChange)="nupOrderChanged">
                            </material-dropdown-select>
                        </div>
                    </material-list-item>
                </div>
            </material-list>
        </div>
    </div>

    <div id="preview-container" *ngIf="previews?.isNotEmpty">
        <img class="preview-image" [class.grayscale]="! color"
            [src]="'data:image/jpeg;base64,' + base64Encode(previews?.first)">
    </div>
</div>

<modal [visible]="showSelectPrinter">
    <material-dialog id="selectPrinter">
        <h1 header>Drucker auswählen</h1>
        <div class="printer-selector">
            <material-button *ngIf="leftPrinter.isNotEmpty" class="printer-selection" (trigger)="printJobLeft()">
                <material-icon class="big-ass-icon" icon="keyboard_arrow_left"></material-icon>
                Linker<br>Drucker
            </material-button>
            <material-button *ngIf="rightPrinter.isNotEmpty" class="printer-selection" (trigger)="printJobRight()">
                Rechter<br>Drucker
                <material-icon class="big-ass-icon" icon="keyboard_arrow_right"></material-icon>
            </material-button>
        </div>

        <div footer>
            <material-button autoFocus clear-size (trigger)="showSelectPrinter = false">
                Abbrechen
            </material-button>
        </div>
    </material-dialog>
</modal>